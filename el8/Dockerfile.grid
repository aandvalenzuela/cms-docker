FROM @BASE_IMAGE_NAME@
LABEL maintainer="CMS Build"
LABEL name="CMS Worker Node on EL - Grid packages"

RUN rpm -qa --queryformat '%{NAME} %{VERSION} %{RELEASE}\n' >> /tmp/package-base.tmp &&\
	dnf --enablerepo=powertools install -y boost-python3 &&\
	dnf install -y gfal2-util-scripts gfal2-all python3-gfal2-util xrootd-client &&\
	dnf install -y @EPEL_PACKAGES@ myproxy &&\
	xcmd="@EXTRA_COMMAND@" &&\
	if [ "$xcmd" = "" ] ; then xcmd=true; fi &&\
	eval $xcmd &&\
	dnf clean all &&\
	/root/fix_ssh_config.sh /etc/ssh/ssh_config &&\
	echo "Timestamp: @BUILD_DATE@" > /image-build-info.txt &&\
        rpm -qa --queryformat '%{NAME} %{VERSION} %{RELEASE}\n' | sort >> /tmp/package-image.tmp &&\
        grep -vf /tmp/package-base.tmp /tmp/package-image.tmp >> /tmp/pkgs-info &&\
        rm -f /tmp/package-base.tmp /tmp/package-image.tmp
	
LABEL build-date="@BUILD_DATE@"
